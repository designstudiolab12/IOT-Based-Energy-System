<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DINESH Energy Meter</title>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<!-- Chart.js for Graph -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #f4fbff;
}

header {
    background: #0d6efd;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 22px;
    font-weight: bold;
}

.container {
    padding: 20px;
}

.section {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

.section h2 {
    margin-top: 0;
    color: #0d6efd;
}

.value {
    font-size: 28px;
    font-weight: bold;
    margin-top: 10px;
}

.bill {
    font-size: 32px;
    color: green;
    font-weight: bold;
}

.login-box {
    max-width: 400px;
    margin: 80px auto;
    background: white;
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

input {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
}

button {
    width: 100%;
    padding: 10px;
    background: #0d6efd;
    color: white;
    border: none;
    cursor: pointer;
}

canvas {
    max-width: 100%;
}

footer {
    text-align: center;
    padding: 10px;
    background: #e9ecef;
}
</style>
</head>

<body>

<!-- LOGIN PAGE -->
<div id="loginPage" class="login-box">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" style="display:none;">

<header>
Smart Electricity Usage & Billing Dashboard
</header>

<div class="container">

    <div class="section">
        <h2>Live Electricity Usage (Today)</h2>
        <div class="value" id="liveUnits">0 Units</div>
    </div>

    <div class="section">
        <h2>Weekly Consumption</h2>
        <div class="value" id="weeklyUnits">0 Units</div>
    </div>

    <div class="section">
        <h2>Monthly Consumption</h2>
        <div class="value" id="monthlyUnits">0 Units</div>
    </div>

    <div class="section">
        <h2>Monthly Electricity Bill</h2>
        <div class="bill" id="billAmount">₹0</div>
    </div>

    <div class="section">
        <h2>Usage Graph</h2>
        <canvas id="usageChart"></canvas>
    </div>

</div>

<footer>
IoT Based Electricity Monitoring System
</footer>

</div>

<script>

// ---------------- LOGIN ----------------
function login(){
    let user = document.getElementById("username").value;
    let pass = document.getElementById("password").value;

    if(user === "Dineshc" && pass === "1497"){
        document.getElementById("loginPage").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
    }
    else{
        alert("Invalid login");
    }
}

// ---------------- FIREBASE CONFIG ----------------
// Replace with your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDw6ue8f2VQPLY-SfYSjQ-8wOXPCSDy7So",
  authDomain: "dinesh-ebs-system.firebaseapp.com",
  databaseURL: "https://dinesh-ebs-system-default-rtdb.firebaseio.com",
  projectId: "dinesh-ebs-system",
  storageBucket: "dinesh-ebs-system.firebasestorage.app",
  messagingSenderId: "544411717146",
  appId: "1:544411717146:web:0e1d121c3f5e49ba4a4ba3",
  measurementId: "G-5GHQ3VFX7L"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ---------------- TARIFF ----------------
function calculateBill(units) {
    let amount = 0;
    if(units <= 100) amount = units * 1.5;
    else if(units <= 200) amount = units * 2.5;
    else amount = units * 4;
    return amount.toFixed(2);
}

// ---------------- LIVE DATA FETCH ----------------
function fetchData(){
    db.ref("Electricity").on("value", (snapshot)=>{
        const data = snapshot.val();

        let live = data.live;
        let weekly = data.weekly;
        let monthly = data.monthly;

        document.getElementById("liveUnits").innerText = live + " Units";
        document.getElementById("weeklyUnits").innerText = weekly + " Units";
        document.getElementById("monthlyUnits").innerText = monthly + " Units";
        document.getElementById("billAmount").innerText = "₹ " + calculateBill(monthly);

        // graph irundha mattum call aagum
        if(data.history){
            updateGraph(data.history);
        }
    });
}


// ---------------- GRAPH ----------------
let chart;
function updateGraph(historyData){
    const ctx = document.getElementById('usageChart');

    if(chart) chart.destroy();

    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: historyData.days,
            datasets: [{
                label: 'Daily Units',
                data: historyData.units
            }]
        }
    });
}

// ---------------- AUTO REFRESH 24HR LOGIC ----------------
setInterval(fetchData, 5000); // every 5 sec for demo

fetchData();

</script>


</body>
</html>
